{
    "contents" : "---\ntitle: \"Graunt’s Life Table Extended\"\nauthor: \"coop711\"\ndate: \"`r Sys.Date()`\"\noutput: html_document\n---\n\n## Lifetable of J. Graunt\n\n### Data\n\n<!--![Graunt 와 1993년 미국](../pics/graunt_table.png)-->\n\n<img src=\"../pics/graunt_table.png\" width = 240>\n\n### Data Input\n\n```{r, data_graunt}\ngraunt <- data.frame(x = c(0, 6, 16, 26, 36, 46, 56, 66, 76), lx.17th = c(100, 64, 40, 25, 16, 10, 6, 3, 1))\n```\n\n* 같은 연령대의 1993년 미국 생명표 입력\n\n```{r, data US 93}\nus.93 <- data.frame(x = graunt$x, lx.93 = c(100, 99, 99, 98, 97, 95, 92, 84, 70))\n```\n\n* 두 자료를 합쳐서 하나의 데이터프레임으로 \n\n```{r, single data frame}\ngraunt.us <- data.frame(graunt, lx.93 = us.93$lx)\ngraunt.us\n```\n\n* Graunt 생명표로부터 개략의 생존함수 도시\n\n```{r, life distribution first draft, fig.width = 6, fig.height = 6}\nplot(graunt$x, graunt$lx.17th, ann = F, xaxt = \"n\", yaxt = \"n\", type = \"b\")\naxis(side = 1, at = graunt$x, labels = graunt$x)\naxis(side = 2, at = graunt$lx.17th, labels = graunt$lx.17th)\nabline(v = c(0, 76), lty = 2)\n```\n\n* 기대수명 파악이 용이하도록 빗금 \n\n```{r, shading to highlight expected life distribution, fig.width=6, fig.height=6}\nplot(graunt$x, graunt$lx.17th, ann=F, xaxt=\"n\", yaxt=\"n\", type=\"b\")\naxis(side = 1, at = graunt$x, labels = graunt$x)\naxis(side = 2, at = graunt$lx.17th, labels = graunt$lx.17th, las = 2)\nabline(v = c(0, 76), lty = 2)\ngraunt.x <- c(graunt$x, 0)\ngraunt.y <- c(graunt$lx.17th, 0)\n# graunt.x <- c(graunt$x, rev(graunt$x))\n# graunt.y<-c(rep(0, length(graunt$x)), rev(graunt$lx.17th))\npolygon(graunt.x, graunt.y, density = 15)\n```\n\n* 윤곽을 파악하기 쉽도록 격자 설정\n\n```{r, setting grids,  fig.width = 6, fig.height = 6}\nplot(graunt$x, graunt$lx.17th, ann = F, xaxt = \"n\", yaxt = \"n\", type = \"b\")\naxis(side = 1, at = graunt$x, labels = graunt$x)\naxis(side = 2, at = graunt$lx.17th, labels = graunt$lx.17th, las = 2)\nabline(v = c(0, 76), lty = 2)\ngraunt.x <- c(graunt$x, 0)\ngraunt.y <- c(graunt$lx.17th, 0)\npolygon(graunt.x, graunt.y, density = 15)\nabline(v = graunt$x, lty = 2)\n```\n\n* 메인 타이틀과 x축, y축 라벨 설정.\n\n```{r, main title xlab and ylab, fig.width = 6, fig.height = 6}\n# par(family = \"Apple SD Gothic Neo\")\nplot(graunt$x, graunt$lx.17th, ann = F, xaxt = \"n\", yaxt = \"n\", type = \"b\")\naxis(side = 1, at = graunt$x, labels = graunt$x)\naxis(side = 2, at = graunt$lx.17th, labels = graunt$lx.17th, las = 2)\nabline(v = c(0, 76), lty = 2)\ngraunt.x <- c(graunt$x, 0)\ngraunt.y <- c(graunt$lx.17th, 0)\npolygon(graunt.x, graunt.y, density = 15)\nabline(v = graunt$x, lty = 2)\n# title(main = \"John Graunt의 생존 곡선\", xlab = \"연령(세)\", ylab = \"생존률(%)\")\ntitle(main = \"Survival Curve of Graunt's Life Table\", xlab = \"Age(years)\", ylab = \"Survived(%)\")\n```\n\n## 1993년 미국의 생명표와 비교\n\n\n* 1993년 미국의 생존함수와 비교하기 위하여 `lines()`에 `type = \"b\"`로 설정. $y$ 축의 70% 가 어떤 의미인지 음미할 것.  \n\n```{r, US 93 added, fig.width=6, fig.height=6}\nplot(graunt$x, graunt$lx.17th, ann=F, xaxt=\"n\", yaxt=\"n\", type=\"b\")\naxis(side=1, at=graunt$x, labels=graunt$x)\naxis(side=2, at=graunt$lx.17th, labels=graunt$lx.17th)\nabline(v=c(0, 76), lty=2)\nlines(us.93$x, us.93$lx.93, type=\"b\")\naxis(side=2, at=70, labels=70)\nabline(h=70, lty=2)\ntext(x=66, y=95, labels=\"미국 1993년\")\n```\n\n* Graunt의 생존곡선과 1993년 미국 생존곡선 사이의 빗금친 부분은 무엇을 상징하는가?\n\n```{r, meaning of shaded area, fig.width = 6, fig.height = 6}\nplot(graunt$x, graunt$lx.17th, ann = F, xaxt = \"n\", yaxt = \"n\", type = \"b\")\naxis(side = 1, at = graunt$x, labels = graunt$x)\naxis(side = 2, at = graunt$lx, labels = graunt$lx.17th, las = 2)\nabline(v = c(0, 76), lty = 2)\n# lines(us.93$x, us.93$lx.93, type = \"b\")\nlines(graunt$x, us.93$lx.93, type = \"b\")\naxis(side = 2, at = 70, labels = 70, las = 1)\nabline(h = 70, lty = 2)\nus.graunt.x <- c(graunt$x, rev(graunt$x))\nus.graunt.y <- c(us.93$lx.93, rev(graunt$lx))\npolygon(us.graunt.x, us.graunt.y, density = 15, col = \"red\", border = NA)\nabline(v = graunt$x, lty = 2)\n# title(main = \"Graunt와 1993년 미국의 생존 곡선\", xlab = \"연령(세)\", ylab = \"생존률(%)\")\ntitle(main = \"Survival Curve of Graunt's and US 93 Life Table\", xlab = \"Age(years)\", ylab = \"Survived(%)\")\n\n```\n\n\n## ggplot\n\n* Work with `graunt.us`\n\n```{r, str graunt.us}\nstr(graunt.us)\n```\n\n* wide format을 long format으로 바꾸기 위해서 'reshape2' 패키지 등록 \n\n```{r, reshape2}\nlibrary(reshape2)\n```\n\n* `melt()` 함수의 사용법에 대하여 도움말 요청\n\n```\n?melt\n```\n\n* 다음 구조를 명확히 이해.\n\n```{r, format of melt}\ngraunt.melt <- melt(graunt.us, id.vars = \"x\", measure.vars = c(\"lx.17th\", \"lx.93\"), value.name = \"lx\", variable.name = \"times\")\ngraunt.melt\nstr(graunt.melt)\n```\n\n* 17세기 생명표와 1993년 생명표를 `times` factor로 구분\n\n```{r, factor level}\nlevels(graunt.melt$times) <- c(\"17th\", \"1993\")\nstr(graunt.melt)\n```\n\n* `ggplot2` 패키지 등록\n\n```{r, library ggplot2}\nlibrary(ggplot2)\n```\n\n* ggplot의 구조를 이해하기 쉽도록 가능한 단계별로 작업하고 저장. `geom_polygon` 작업에서 `data.frame`과 `aes`가 바뀌므로 `ggplot()`을 비워놓은 점에 유의.\n\n```{r, geom_point geom_line, fig.width = 6, fig.height = 6}\ng1 <- ggplot() + geom_point(data = graunt.melt, aes(x = x, y = lx, colour = times))\ng1\ng2 <- g1 + geom_line(data = graunt.melt, aes(x = x, y = lx, colour = times))\ng2\ng3 <- g2 + theme_bw()\ng3\n```\n\n* polygon 으로 두 생명곡선의 차이를 드러내기 위해서는 polygon의 좌표를 나타내는 별도의 데이터 프레임이 필요함.\n\n```{r, polygon data}\ngraunt.poly <- data.frame(x = graunt.melt[c(1:9, 18:10), 1], y = graunt.melt[c(1:9, 18:10), 3])\ngraunt.poly\n```\n\n```{r, polygon, fig.width = 6, fig.height = 6}\ng4 <- g3 + geom_polygon(data = graunt.poly, aes(x = x, y = y), alpha = 0.3, fill = \"red\")\ng4\n```\n\n#### Starting with a different plot\n\n* 점들을 선으로 이어주기 위하여 `geom_line()`를 사용하면 원하지 않는 결과를 얻게 됨. `geom_path()`를 사용하여야 함.\n\n```{r, geom_point, fig.width = 6, fig.height = 6}\np1 <- ggplot(graunt.poly, aes(x = x, y = y)) + geom_point() \np1\np2 <- p1 + geom_path() \np2\np3 <- p2 + geom_polygon(alpha = 0.3, fill = \"red\")\np3\np4 <- p3 + theme_bw()\np4\n```\n\n* 타이틀과 자막에 한글을 넣는 방법은 다음 시간에^^\n\n\n```{r, save, echo = FALSE}\nsave.image(\"graunt_160316.rda\")\n```\n",
    "created" : 1458051956618.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1577383775",
    "id" : "9CC82963",
    "lastKnownWriteTime" : 1458575882,
    "path" : "~/Google 드라이브/Works/Class/Case_Studies_in_Stat/R.WD/Lifetable/R/Graunt160316.Rmd",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "type" : "r_markdown"
}